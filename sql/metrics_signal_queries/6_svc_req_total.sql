\copy (select 'service_req_total' as name, date_trunc('seconds',  time::timestamp) as ztime ,left(labels ->> 'destination_service', strpos(labels ->> 'destination_service', '.') - 1) service, value from metrics where name = 'istio_requests_total' and labels ->> 'destination_service_namespace' = 'default' and (labels ->> 'destination_service' like 'checkoutservice%' or labels ->> 'destination_service' like 'cartservice%' or labels ->> 'destination_service' like 'emailservice%' or labels ->> 'destination_service' like 'currencyservice%' or labels ->> 'destination_service' like 'paymentservice%' or labels ->> 'destination_service' like 'productcatalogservice%' or labels ->> 'destination_service' like 'shippingservice%') and time between '2020-02-27 22:49:50'::timestamp and '2020-02-28 20:44:00'::timestamp) TO '/Users/hmohamed/github/data-research-spring2020/raw-data-linode-run3/6_service_req_total.csv' CSV HEADER
